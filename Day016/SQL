#0718
SELECT SUM(SAL) FROM EMP;
SELECT DEPTNO, SUM(SAL) FROM EMP GROUP BY DEPTNO ORDER BY DEPTNO;

SELECT ENAME, SUM(SAL) FROM EMP GROUP BY ENAME;

#EMP 테이블 직원 수
SELECT COUNT(*) FROM EMP;
SELECT * FROM EMP;

#가장 높은 급여, 가장 낮은 급여
SELECT MAX(SAL), MIN(SAL) FROM EMP;
#부서번호가 20인 사원의 입사일 중 제일 오래된 입사일 출력
SELECT MIN(HIREDATE) FROM EMP WHERE DEPTNO=20;
#30번 부서 사원 평균 급여 소수점 둘째 자리에서 반올림
SELECT ROUND(AVG(SAL),1) FROM EMP WHERE DEPTNO=30;

#부서별 평균급여 소수점 둘째 자리에서 반올림
SELECT DEPTNO, ROUND(AVG(SAL),1) FROM EMP GROUP BY DEPTNO ORDER BY DEPTNO;
#부서번호 및 직책별 평균 급여 정렬
SELECT DEPTNO, JOB, ROUND(AVG(SAL),1) FROM EMP
GROUP BY DEPTNO, JOB
ORDER BY DEPTNO, JOB;
#GROUP BY절 부서 번호별 평균 추가 수당
SELECT DEPTNO, NVL(AVG(COMM),0) FROM EMP GROUP BY DEPTNO;

#평균급여 2000달러 이상 부서와 직책
SELECT DEPTNO, JOB, AVG(SAL) FROM EMP
GROUP BY DEPTNO, JOB
HAVING AVG(SAL) >= 2000
ORDER BY DEPTNO, JOB;
#평균급여 2000이상 3000이하 부서와 직책
SELECT DEPTNO, JOB, AVG(SAL) FROM EMP
GROUP BY DEPTNO, JOB
HAVING AVG(SAL) >= 2000 AND AVG(SAL) <= 3000
ORDER BY DEPTNO, JOB;
#WHERE 사용
SELECT DEPTNO, JOB, AVG(SAL) FROM EMP
WHERE SAL <= 3000
GROUP BY DEPTNO, JOB
HAVING AVG(SAL) >= 2000
ORDER BY DEPTNO, JOB;

#P212 1
SELECT DEPTNO, TRUNC(AVG(SAL)) AVG_SAL, 
        MAX(SAL) MAX_SAL, MIN(SAL) MIN_SAL, COUNT(*) CNT 
FROM EMP GROUP BY DEPTNO; 
#2
SELECT JOB, COUNT(*) FROM EMP GROUP BY JOB HAVING COUNT(*)>=3;
SELECT * FROM EMP;
#3
SELECT TO_CHAR(HIREDATE, 'YYYY') HIRE_YEAR, DEPTNO , COUNT(*)
FROM EMP GROUP BY TO_CHAR(HIREDATE, 'YYYY'), DEPTNO ORDER BY HIRE_YEAR;
#4
SELECT NVL2(COMM,'O','X') EXIST_COMM, COUNT(*) CNT FROM EMP
GROUP BY NVL2(COMM,'O','X');
 
#JOIN 테이블 결합
SELECT * FROM DEPT;
SELECT EMPNO, ENAME, DEPTNO FROM EMP;

#REAL JOIN -> M*N
#DEPT 4 * EMP 12
SELECT * FROM DEPT;
SELECT * FROM EMP;
SELECT * FROM EMP, DEPT;
SELECT COUNT(*) FROM EMP, DEPT;

#실제 사용 JOIN 구문 
#8-2
SELECT EMPNO, ENAME, LOC FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO
ORDER BY EMPNO;

#EMP 테이블 사원번호 DEPT 테이블 부서 이름 출력 JOIN 쿼리
SELECT E.EMPNO, D.DNAME FROM EMP E, DEPT D
WHERE E.DEPTNO =  D.DEPTNO
ORDER BY EMPNO;

#등가조인
SELECT E.EMPNO, E.ENAME, D.DEPTNO, D.DNAME, D.LOC
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO;

#P239 1
SELECT D.DEPTNO, D.DNAME, E.EMPNO, E.ENAME, E.SAL
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO AND E.SAL > 2000
ORDER BY DEPTNO;

#2
SELECT D.DEPTNO, D.DNAME, TRUNC(AVG(E.SAL)) AVG_SAL, 
        MAX(E.SAL) MAX_SAL, MIN(E.SAL) MIN_SAL, COUNT(*) CNT
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO
GROUP BY D.DEPTNO, D.DNAME
ORDER BY D.DEPTNO;

#연습 위한 테이블
DROP TABLE DEPT_SEQUENCE;
CREATE TABLE DEPT_SEQUENCE
    AS SELECT * FROM DEPT
        WHERE 1 <> 1;
        
#테이블 생성 확인
SELECT * FROM DEPT_SEQUENCE;
DESC DEPT_SEQUENCE;

#SEQ 쿼리로 만들기
CREATE SEQUENCE SEQ_DEPT_SEQUENCE
INCREMENT BY 10
START WITH 10
MAXVALUE 90
MINVALUE 0
NOCYCLE
CACHE 2;

#시퀀스 확인
SELECT * FROM USER_SEQUENCES;

#시퀀스 사용
INSERT INTO DEPT_SEQUENCE (DEPTNO, DNAME, LOC)
VALUES (SEQ_DEPT_SEQUENCE.NEXTVAL, 'DATABASE', 'SEOUL');

SELECT * FROM DEPT_SEQUENCE;

#시퀀스 번호 확인
SELECT SEQ_DEPT_SEQUENCE .CURRVAL 
FROM DUAL;

#시퀀스 수정
ALTER SEQUENCE SEQ_DEPT_SEQUENCE
INCREMENT BY 3
MAXVALUE 99
CYCLE;

COMMIT;

#시퀀스 삭제
DROP SEQUENCE SEQ_DEPT_SEQUENCE;
